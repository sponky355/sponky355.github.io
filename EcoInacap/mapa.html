<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mapa de Puntos Verdes | EcoINACAP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- CSS y fuentes -->
  <link rel="stylesheet" href="css/estilos.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  
  <style>
    /* Estructura principal */
    .mapa-page {
      display: flex;
      min-height: 100vh;
      font-family: 'Montserrat', sans-serif;
    }

    /* Estilos para los grupos de filtros */
    .filtro-group {
      margin-bottom: 25px;
    }
    
    .filtro-group h3 {
      font-size: 1.1rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #a5d6a7;
    }
    
    .filtro-group h3 i {
      font-size: 1rem;
    }
    
    /* Botones de filtro */
    .filtro-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 10px;
      background: rgba(255,255,255,0.1);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
    }
    
    .filtro-btn:hover {
      background: rgba(255,255,255,0.2);
      transform: translateX(5px);
    }
    
    .filtro-btn.active {
      background: #4caf50;
      font-weight: 600;
    }
    
    .filtro-btn i {
      font-size: 1.1rem;
      width: 20px;
      text-align: center;
    }
    
    /* Sidebar de filtros */
    .filtros-sidebar {
      width: 280px;
      background: #2e7d32;
      color: white;
      padding: 25px 20px;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
    }
    
    .filtros-sidebar h2 {
      font-size: 1.5rem;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .filtros-sidebar h2 i {
      font-size: 1.3rem;
    }
    
    /* Contenedor del mapa */
    .mapa-main {
      flex: 1;
      padding: 20px;
      background: #f5f5f5;
    }
    
    #map {
      height: calc(100vh - 40px);
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border: 2px solid #81c784;
    }
    
    /* Estilos para los marcadores personalizados */
    .custom-marker {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      border: 2px solid white;
      transition: all 0.3s ease;
    }
    
    .custom-marker:hover {
      transform: scale(1.2);
      z-index: 1000 !important;
    }
    
    /* Colores según tipo de material */
    .marker-papel {
      background: #2196F3; /* Azul para papel */
    }
    
    .marker-plastico {
      background: #FF5722; /* Naranja para plástico */
    }
    
    .marker-vidrio {
      background: #4CAF50; /* Verde para vidrio */
    }
    
    .marker-metal {
      background: #607D8B; /* Gris azulado para metal */
    }
    
    .marker-electronico {
      background: #9C27B0; /* Morado para electrónicos */
    }
    
    .marker-inacap {
      background: #1B5E20; /* Verde oscuro para INACAP */
      width: 42px;
      height: 42px;
      font-size: 18px;
    }
    
    .marker-user {
      background: #E91E63; /* Rosa para ubicación usuario */
    }
    
    /* Popup estilizado */
    .leaflet-popup-content {
      min-width: 250px;
      font-family: 'Montserrat', sans-serif;
    }
    
    .leaflet-popup-content h3 {
      color: #2e7d32;
      margin-top: 0;
      font-size: 1.2rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 8px;
    }
    
    .leaflet-popup-content p {
      margin: 8px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .leaflet-popup-content i {
      width: 16px;
      color: #2e7d32;
      text-align: center;
    }
    
    /* Leyenda */
    .map-legend {
      position: absolute;
      bottom: 30px;
      right: 30px;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    
    .map-legend h4 {
      margin-top: 0;
      margin-bottom: 10px;
      color: #2e7d32;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 10px;
      border: 2px solid white;
    }
  </style>
</head>
<body>
  <div class="mapa-page">
    <!-- Sidebar de filtros -->
    <div class="filtros-sidebar">
      <h2><i class="fas fa-filter"></i> Filtros</h2>

    <div class="filtro-group">
      <h3><i class="fas fa-layer-group"></i> Tipo de Material</h3>
      <button class="filtro-btn active" data-tipo="todos">
        <i class="fas fa-th-list"></i> Todos
      </button>
      <button class="filtro-btn" data-tipo="papel">
        <i class="fas fa-newspaper"></i> Papel/Cartón
      </button>
      <button class="filtro-btn" data-tipo="plastico">
        <i class="fas fa-bottle-water"></i> Plástico
      </button>
      <button class="filtro-btn" data-tipo="vidrio">
        <i class="fas fa-wine-bottle"></i> Vidrio
      </button>
      <button class="filtro-btn" data-tipo="metal">
        <i class="fas fa-cubes"></i> Metal
      </button>
      <button class="filtro-btn" data-tipo="electronico">
        <i class="fas fa-battery-full"></i> Electrónicos
      </button>
    </div>
  </div>
      
<div class="filtro-group">
  <h3><i class="fas fa-clock"></i> Horario</h3>
  <button class="filtro-btn" data-tipo="manana">
    <i class="fas fa-sun"></i> Mañana (8:00-12:00)
  </button>
  <button class="filtro-btn" data-tipo="tarde">
    <i class="fas fa-cloud-sun"></i> Tarde (12:00-18:00)
  </button>
  <button class="filtro-btn" data-tipo="finde">
    <i class="fas fa-calendar-weekend"></i> Fin de semana
  </button>
</div>

<div class="filtro-group">
  <h3><i class="fas fa-map-marker-alt"></i> Ubicación</h3>
  <button class="filtro-btn" data-tipo="inacap">
    <i class="fas fa-school"></i> Dentro de INACAP
  </button>
  <button class="filtro-btn" data-tipo="cercano">
    <i class="fas fa-location-arrow"></i> Más cercanos
  </button>
</div>
    
    <!-- Contenido principal -->
    <div class="mapa-main">
      <div id="map"></div>
    </div>
  </div>
      
      <!-- Leyenda -->
      <div class="map-legend">
        <h4><i class="fas fa-key"></i> Leyenda</h4>
        <div class="legend-item">
          <div class="legend-color marker-inacap"></div>
          <span>INACAP</span>
        </div>
        <div class="legend-item">
          <div class="legend-color marker-papel"></div>
          <span>Papel/Cartón</span>
        </div>
        <div class="legend-item">
          <div class="legend-color marker-plastico"></div>
          <span>Plástico</span>
        </div>
        <div class="legend-item">
          <div class="legend-color marker-vidrio"></div>
          <span>Vidrio</span>
        </div>
        <div class="legend-item">
          <div class="legend-color marker-metal"></div>
          <span>Metal</span>
        </div>
        <div class="legend-item">
          <div class="legend-color marker-electronico"></div>
          <span>Electrónicos</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  
  <script>
// Inicializar mapa centrado en INACAP Santiago Centro
const map = L.map('map').setView([-33.45694, -70.64827], 15);

// Capa base del mapa
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

// Función para crear marcadores personalizados
function crearMarcador(tipo, esInacap = false) {
  const iconos = {
    'papel': 'fas fa-newspaper',
    'plastico': 'fas fa-bottle-water',
    'vidrio': 'fas fa-wine-bottle',
    'metal': 'fas fa-cubes',
    'electronico': 'fas fa-battery-full',
    'default': 'fas fa-trash-alt'
  };

  const clase = esInacap ? 'marker-inacap' : `marker-${tipo}`;
  const icono = iconos[tipo] || iconos.default;

  return L.divIcon({
    className: '',
    html: `
      <div class="custom-marker ${clase}">
        <i class="${icono}"></i>
      </div>
    `,
    iconSize: esInacap ? [42, 42] : [36, 36],
    iconAnchor: esInacap ? [21, 42] : [18, 36],
    popupAnchor: [0, -30]
  });
}

// Puntos de reciclaje de ejemplo
const puntosVerdes = [{
    nombre: "INACAP Santiago Centro - Punto Principal",
    coords: [-33.45694, -70.64827],
    tipo: 'papel', // Mantener 'papel' para consistencia en el filtro
    emoji: "🏫",
    horario: "Lunes a Viernes 8:00-20:00",
    direccion: "Av. Vitacura 10.151, Vitacura",
    contacto: "sustentabilidad@inacap.cl",
    dentroInacap: true
  },
  {
    nombre: "Punto Verde Plaza de Armas",
    coords: [-33.4372, -70.6506],
    tipo: 'plastico',
    horario: "Lunes a Domingo 9:00-18:00",
    direccion: "Plaza de Armas, Santiago Centro",
    dentroInacap: false
  },
  {
    nombre: "Punto Verde Parque Forestal",
    coords: [-33.4359, -70.6422],
    tipo: 'vidrio',
    horario: "Martes a Domingo 10:00-19:00",
    direccion: "Parque Forestal, Santiago",
    dentroInacap: false
  },
  {
    nombre: "Punto Verde Reciclaje Electrónico",
    coords: [-33.4465, -70.6358],
    tipo: 'electronico',
    horario: "Lunes a Viernes 10:00-16:00",
    direccion: "Av. Libertador Bernardo O'Higgins 123",
    dentroInacap: false
  },
  {
    nombre: "INACAP Santiago Centro - Punto Secundario",
    coords: [-33.4572, -70.6471],
    tipo: 'metal', // Mantener 'metal' para consistencia
    horario: "Lunes a Viernes 9:00-19:00",
    direccion: "Av. Vitacura 10.151, Vitacura",
    contacto: "sustentabilidad@inacap.cl",
    dentroInacap: true
  }
];

let marcadores = [];

// Función para mostrar puntos en el mapa
function mostrarPuntos(tipo = 'todos') {
  // Limpiar marcadores existentes
  marcadores.forEach(marker => map.removeLayer(marker));
  marcadores = [];

  // Filtrar y agregar marcadores
  puntosVerdes.forEach(punto => {
    // Si el tipo es 'todos' O el tipo del punto coincide con el tipo seleccionado
    if (tipo === 'todos' || punto.tipo === tipo) {
      const marker = L.marker(punto.coords, {
        icon: crearMarcador(punto.tipo, punto.dentroInacap)
      }).addTo(map);

      // Popup con información
      marker.bindPopup(`
        <h3>${punto.nombre}</h3>
        <p><i class="fas fa-trash-alt"></i> <b>Tipo:</b> ${obtenerNombreTipo(punto.tipo)}</p>
        <p><i class="fas fa-clock"></i> <b>Horario:</b> ${punto.horario}</p>
        <p><i class="fas fa-map-marker-alt"></i> <b>Dirección:</b> ${punto.direccion}</p>
        ${punto.contacto ? `<p><i class="fas fa-envelope"></i> <b>Contacto:</b> ${punto.contacto}</p>` : ''}
      `);

      marcadores.push(marker);
    }
  });
}

// Función para obtener nombre completo del tipo (para mostrar en el popup)
function obtenerNombreTipo(tipo) {
  const nombres = {
    'papel': 'Papel/Cartón',
    'plastico': 'Plástico',
    'vidrio': 'Vidrio',
    'metal': 'Metal',
    'electronico': 'Electrónicos'
  };
  return nombres[tipo] || tipo;
}

// Mostrar todos los puntos al cargar
mostrarPuntos('todos');

// Geolocalización del usuario
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(pos => {
    const userLat = pos.coords.latitude;
    const userLng = pos.coords.longitude;

    // Marcador para la ubicación del usuario
    const userIcon = L.divIcon({
      className: '',
      html: `
        <div class="custom-marker marker-user">
          <i class="fas fa-user"></i>
        </div>
      `,
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    });

    L.marker([userLat, userLng], {
      icon: userIcon
    }).addTo(map).bindPopup("<b>Tu ubicación actual</b>");

    // Centrar mapa en la ubicación del usuario (con zoom intermedio)
    map.setView([userLat, userLng], 14);
  }, () => {
    console.log("No se pudo obtener la ubicación del usuario");
  });
}

// Event listeners para los filtros
document.querySelectorAll('.filtro-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const tipo = this.getAttribute('data-tipo');
    mostrarPuntos(tipo);

    // Actualizar clase activa
    document.querySelectorAll('.filtro-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
  });
});
  </script>
</body>
</html>